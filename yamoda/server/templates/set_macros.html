{% macro setlist_script() %}
{% coffee "setlist" %}
$ ->
  dtable = yamoda.utils.setup_datatable($("#setlist_table"))
  yamoda.utils.setup_column_filter_boxes($("#setlist_table th.footer input.filter-input"), dtable)
{% endcoffee %}
{% endmacro %}

{% macro setlist(sets) %}
{# just a table with sets  #}
<table id="setlist_table" class="table table-condensed table-bordered table-striped">
  <thead>
    <tr>
      <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Set #</th>
      <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Name</th>
      <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Subsets</th>
      <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Datas</th>
      <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Created</th>
    </tr>
  </thead>
  <tbody>
  {%- for set in sets %}
    <tr>
      <td>{{ loop.index }}</td>
      <td><a href="{{ url_for('set', set_id=set.id) }}" rel="tooltip" title="show contained subsets and data">{{ set.name }}<span class="detail-marker">&nbsp;&gt;&gt;</span></a></td>
      <td>{{ set.children|length }}</td>
      <td>{{ set.datas|length }}</td>
      <td>{{ set.created|dtformat }}</td>
    </tr>
  {%- endfor %}
  </tbody>
  <tfoot>
    <th class="footer"><input type="text" name="filter_number" class="filter-input filter-init input-small" value="Filter #" data-column_num="0" /></th>
    <th class="footer"><input type="text" name="filter_name" class="filter-input filter-init input-large" value="Filter names" data-column_num="1" /></th>
    <th class="footer"><input type="text" name="filter_entries_count" class="filter-input filter-init input-small" value="# subsets" data-column_num="2" /></th>
    <th class="footer"><input type="text" name="filter_datas_count" class="filter-input filter-init input-small" value="# datas" data-column_num="3" /></th>
    <th class="footer"><input type="text" name="filter_created" class="filter-input filter-init input-medium" value="Filter dates" data-column_num="4" /></th>
  </tfoot>
</table>
{% endmacro %}

{% macro create_set_modal(parent=None, div_name="new_set") %}
  <div class="modal hide" id="{{ div_name }}">
    <form class="modal-form" action="{{ url_for('create_set') }}" method="post">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h3>Create new {% if parent %}sub{% endif %}set</h3>
        As a child of Set #<input type="text" class="span2" name="parent_set_id"
        {%if parent %}
        value="{{ parent.id }}"
        {% else %}
        placeholder="Toplevel"
        {% endif %}
        >
      </div>
      <div class="modal-body">
        Name: <input type="text" class="span3" placeholder="Set name…" name="name">
        <input type="hidden" name="data_ids">
        <p style="hidden" class="data-ids"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
          <i class="icon-ok-sign icon-white"></i> Create
        </button>
      </div>
    </form>
  </div>
{% endmacro %}

{% macro setlist_with_controls(sets, parent) %}
{# setlist with additional set controls (new set)  #}
  <div id="new_set_action">
    <a class="btn" data-toggle="modal"
      href="#new_set">Create {% if parent %}sub{% endif %}set</a>
  </div>

  {% if sets %} 
  <script>
  {% coffee "setlist_controls" %}
  $ ->
    $("#setlist_table_wrapper .datatables-top-left-bar").append($("#new_set_action").remove())
  {% endcoffee %}
  </script>
  {{ setlist(sets) }}
  {% endif %} 

  {{ create_set_modal(parent) }}
{% endmacro %}

{# vim: set filetype=htmljinja sw=2 ts=2 sts=2 expandtab: #}
