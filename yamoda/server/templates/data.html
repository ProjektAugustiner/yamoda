{% from "entry_macros.html" import entryvalue %}
{% from "plotting.html" import plotdisplay_includes, plotdisplay1D %}
{% from "comment_macros.html" import comment_table, new_comment, comment_toggle_script %}
{% extends "layout.html" %}
{% set title = "Data" %}
{% block extrahead %}
{{ plotdisplay_includes() }}
<!-- external libs -->
<script src="{{ url_for('static', filename='js/jquery.sparkline.js') }}"></script>
<!-- yamoda modules -->
<script src="{{ url_for('static', filename='gen_js/entry.js') }}"></script>
<script src="{{ url_for('static', filename='gen_js/data.js') }}"></script>
<script>
{{ comment_toggle_script() }}
</script>
{% endblock %}
{% block body %}
<div class="row-fluid">
  <div class="span12">
    <h2>Plot</h2>
    <div class="span12">
      {{ plotdisplay1D("plot") }}
    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="span12">
    <hr class="small-vertical-margin">
    <a id="plot_btn" class="btn" href="#" rel="tooltip" title="plot selected 1D entries, x (first selection) vs. y (second selection)">Plot Selection</a>
    {# Display data navigation buttons. 
      Buttons are disabled if there is no previous resp. next data.
    #}
    {% if previous_data %}
    <a id="previous_data_btn" class="btn" href="{{url_for('data', data_id=previous_data.id)}}" rel="tooltip" title="Go to previous data">
      <i class="icon-backward"></i>
      Previous Data #{{ previous_data.id }}
    </a>
    {% else %}
    <a id="previous_data_btn" class="btn disabled" href="#" rel="tooltip" title="no previous data">
      <i class="icon-backward"></i>
      Previous Data
    </a>
    {% endif %}

    {% if from_set %}
    <a id="back_to_set_btn" class="btn" href="{{url_for('set', set_id=from_set.id)}}">
      <i class="icon-chevron-up"></i>
      Back to Set #{{ from_set.id }}
    </a>
    {% else %}
    <a id="back_to_set_btn" class="btn disabled" href="#" rel="tooltip" title="unavailable">
      <i class="icon-chevron-up"></i>
      Back to Set
    </a>
    {% endif %}

    {% if next_data %}
    <a id="next_data_btn" class="btn" href="{{url_for('data', data_id=next_data.id)}}" rel="tooltip" title="Go to next data">
      Next Data #{{ next_data.id }}
      <i class="icon-forward"></i>
    </a>
    {% else %}
    <a id="next_data_btn" class="btn disabled" href="#" rel="tooltip" title="no next data">
      <i class="icon-forward"></i>
      Next Data
    </a>
    {% endif %}
    <hr class="small-vertical-margin">
    <h2>Data: {{ data.name }} 
    <small>(#{{ data.id }})</small>
    <small>Created {{ data.created|dtformat }}</small></h2>
    {# entry display table starts here #}
    <table id="entrytable" class="table table-condensed table-bordered table-striped">
      <thead>
        <tr>
          <th class="hidden"></th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Parameter</th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Value</th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Unit</th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Details</th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Dim</th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Size</th>
          <th class="header colresize" rel="tooltip" title="Click to sort, hold shift key to sort multiple columns">Visible?</th>
        </tr>
      </thead>
      <tbody>
        {%- for entry in data.entries %}
        <tr>
          <td class="hidden indexcolumn" index="{{ loop.index }}" entry_id="{{entry.id}}"></td>
          <td>
            {# Link to the Parameter description, parameter.brief is used as tooltip #}
            <a href="{{ url_for('context', context_name=entry.parameter.context.name)
                     }}#{{ entry.parameter.name }}"
               rel="tooltip" title="{{ entry.parameter.brief }}">
              {{ entry.parameter.name }}
            </a>
          </td>
          {{ entryvalue(entry, 500) }}
          <td>{{ entry.parameter.unit|unitformat }}</td>
          {% if entry.value.shape %}
          <td class="url-column"><a id="entry_url_{{loop.index0}}" href="{{url_for('entry', entry_id=entry.id)}}">Show<span class="detail-marker">&nbsp;&gt;&gt;</span><a></td>
          {% else %}
          <td>-</td>
          {% endif %}
          <td class="value-dimension">{{ entry.value|dimension }}D</td>
          {% if entry.value.shape %}
          <td>{{ entry.value|shape }}</td>
          {% else %}
          <td>-</td>
          {% endif %}
          <td>{{ entry.parameter.visible|yesnoformat }}</td>
        </tr>
        {%- endfor %}
      </tbody>
        <tfoot>
          <th class="footer"><input type="text" name="filter_param" class="filter-input filter-init input-mini" value="Filter" data-column_num="1" /></th>
          <th></th>
          <th class="footer"><input type="text" name="filter_unit" class="filter-input filter-init input-mini" value="Filter" data-column_num="3" /></th>
          <th></th>
          <th class="footer"><input type="text" name="filter_dim" class="filter-input filter-init input-mini" value="Filter" data-column_num="5" /></th>
          <th class="footer"><input type="text" name="filter_size" class="filter-input filter-init input-mini" value="Filter" data-column_num="6" /></th>
          <th class="footer"><input type="text" name="filter_visible" class="filter-input filter-init input-mini" value="Visible?" data-column_num="7" /></th>
        </tfoot>
    </table>
  </div>
</div>
<br>
<hr>
<a href="#" id="show_comments_btn" class="btn btn-large"><i class="icon-list"></i>Show Comments ({{ data.comments|length }})</a>
<div id="comment_section" style="display:none;">
  <a href="#" id="hide_comments_btn" class="btn"><i class="icon-list"></i>Hide Comments</a>
  <h3>Comments for this Data:</h3>
  {% if data.comments %}
  {{ comment_table(data.comments) }}
  {% else %}
  <p>No comments yet.</p>
  {% endif %}
  <br>
  {{ new_comment(url_for("post_data_comment", data_id=data.id)) }}
</div>
{% endblock %}

{# vim: set filetype=htmljinja sw=2 ts=2 sts=2 expandtab: #}
