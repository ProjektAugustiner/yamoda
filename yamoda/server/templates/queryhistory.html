{% macro queryhistory_includes() %}
{% endmacro %}

{% macro queryhistory_table(query_history) %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/yamoda-datatable.css') }}" />
<!-- modal for renaming saved queries -->
<div id="query_rename_modal" class="modal hide fade">
  <div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Change Query Names</h3>
    <strong id="query_rename_message"></strong>
  </div>
  <div class="modal-body">
    <form action="{{ url_for('search') }}" method="post" class="form-horizontal" id="query_rename_form">
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal" aria-hidden="true">Close</a>
    <a href="#" id="query_rename_save" class="btn btn-primary">Save changes</a>
  </div>
</div>
<table id="query_history_table" class="table table-condensed table-bordered table-striped table-hover">
  <thead>
    <tr>
      <th class="header colresize">#</th>
      <th class="header colresize">Created</th>
      <th class="header colresize">Name</th>
      <th class="header colresize">Query String</th>
      <th class="header colresize">Favorite?</th>
      <th class="header">Edit</th>
      <th><input type="checkbox" id="query_checkbox_all" /></th>
    </tr>
  </thead>
  <tbody>
    {%- for query in query_history %}
    <tr data-row_num="{{ loop.index0 }}">
      <td class="query-id">{{ loop.index }}</td>
      <td>{{ query.created|dtformat }}</td>
      <td class="query-name" id="query_name_{{ loop.index0 }}">{{ query.name }}</td>
      <td>
        <a href="#" onclick="yamoda.queryhistory.run_query('{{ loop.index0 }}');" id="query_{{ loop.index0 }}" class="query_popover">{{- query.query_string -}}</a>
      </td>
      <td id="query_favorite_{{ loop.index0 }}">{{query.favorite|yesnoformat }}</td>
      <td><a href="#" onclick="yamoda.queryhistory.insert_query('{{ loop.index0 }}');">Edit</a></td>
      <td><input type="checkbox" class="querycheck" /></td>
    </tr>
    {%- endfor %}
  </tbody>
  <tfoot>
    <tr>
      <th class="footer"><input type="text" name="search_number" class="filter-input filter-init input-small" value="Filter #" /></th>
      <th class="footer"><input type="text" name="search_created" class="filter-input filter-init input-medium" value="Filter dates" /></th>
      <th class="footer"><input type="text" name="search_name" class="filter-input filter-init input-medium" value="Filter names" /></th>
      <th class="footer"><input type="text" name="search_query" class="filter-input filter-init input-xlarge" value="Filter queries" /></th>
      <th class="footer"><input type="text" name="search_favorite" class="filter-input filter-init input-small" value="Favorite?" /></th>
      <th class="footer" colspan="2" style="overflow: visible;">
        <!-- adapted from datalist.html -->
        <div id="actionbutton" style="float:right;">
        <div class="btn-group">
          <button id="action_dropdown" class="btn dropdown-toggle btn-mini" data-toggle="dropdown" data-loading-text="Executing...">
            With selected
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li><a id="delete_query_action" href="#">Delete</a></li>
            <li><a id="toggle_favorite_query_action" href="#">Toggle Favorite Status</a></li>
            <li><a id="rename_query_action" href="#query_rename_modal" role="button" data-toggle="modal">Change Name</a></li>
          </ul>
        </div>
        <div class="alert alert-error hide" id="actionerror"></div>
        </div>
      </th>
    </tr>
  </tfoot>
</table>
{% endmacro %}

{{ queryhistory_table(query_history) }}

{# vim: set filetype=htmljinja sw=2 ts=2 sts=2 expandtab: #}
