{% extends "layout.html" %}
{% from "setlist.html" import setlist with context %}
{% set title = "Dataset" %}
{% block body %}
  <h2>Dataset: {{ set.name }}</h2>
  {%- if set.children %}
  <p>Subsets:</p>
  {{ setlist(set.children, set) }}
  <hr />
  {%- endif %}
  {%- if set.datas %}
  <p>Data in this set:</p>
  <div class="newbutton"><a class="btn" href="{{ url_for('setimport', id=set.id) }}">Import data</a></div>
  <table id="datatable" class="table table-condensed table-bordered table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Context</th>
        <th>Entries</th>
        <th>Created</th>
        {% for p in params %}
        <th rel="tooltip" title="{{ p.brief }}">{{ p.name }} ({{ p.unit }})</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
    {%- for data in set.datas %}
      <tr>
        <td>{{ loop.index }}</td>
        <td><a href="{{ url_for('data', id=data.id) }}">{{ data.name }}</a></td>
        <td>{{ data.context.name }}</td>
        <td>{{ data.entries|length }}</td>
        <td>{{ data.created|dtformat }}</td>
        {% for pv in pvalues[loop.index0] %}
        <td>{{ pv|dataformat }}</td>
        {% endfor %}
      </tr>
    {%- endfor %}
    </tbody>
  </table>
  <script>
    $(document).ready(function() {
      $('#datatable').dataTable({
        bLengthChange: false, bPaginate: false, sDom: 'f<"datatoolbar">rtip'});
      $(".datatoolbar").append($(".newbutton").remove());
    });
  </script>
  {%- else %}
  <p>There is no data in this set.</p>
  <p><a class="btn" href="{{ url_for('setimport', id=set.id) }}">Import data</a></p>
  {%- endif %}
{% endblock %}
