{% extends "layout.html" %}
{% from "queryhistory.html" import queryhistory_table %}
{% set title = "Search" %}

{% block js %}
<!-- yamoda modules -->
<script src="{{ url_for('static', filename='gen_js/search.js') }}"></script>
<script src="{{ url_for('static', filename='gen_js/queryhistory.js') }}"></script>
<script>
{% coffee "search" %}
$ ->
  yamoda.add_module_constants("yamoda.search",
    search_url: "{{ url_for('do_search') }}"
    save_query_url: "{{ url_for('save_query') }}"
    query_history_url: "{{ url_for('get_query_history') }}"
    helptext_url: "{{ url_for('get_helptext', name='') }}")

  yamoda.add_module_constants("yamoda.queryhistory",
    del_queries_url: "{{ url_for('delete_queries') }}"
    rename_queries_url: "{{ url_for('rename_queries') }}"
    toggle_favorite_queries_url: "{{ url_for('toggle_favorite_queries') }}")

  yamoda.search.register_event_handlers()

{% if run_query %}
  yamoda.search.send_query_request(save_query=false)
{% endif %}
  return

{% endcoffee %}
</script>
{% endblock js %}

{% block body %}
<div class="row-fluid">
  <div class="span5">
    <h2>Search for sets or datas</h2>
    <form class="form-vertical" id="query_form">
      <div class="control-group">
        <label class="control-label" for="query">Enter Query:</label>
        <div class="controls">
          <textarea name="query" id="query_input" class="field span12" rows="6">{{ query.query_string }}</textarea>
        </div>
        <input type="text" id="query_name_input" name="name" value="{{ query.name }}"><span class="help-inline">Name of query</span>
      </div>
      <div class="form-actions">
        <a href="#" id="submit_button" class="btn btn-primary">
          <i class="icon-ok-sign icon-white"></i>Run Query</a>
        <a href="#" id="reset_button" class="btn btn-warning">
          <i class="icon-trash icon-white"></i>Clear</button>
        <a href="#" id="show_help" class="btn">
          <i class="icon-arrow-right"></i>Show Help</a>
        <a href="#" style="display: none;" id="hide_help" class="btn">
          <i class="icon-arrow-left"></i>Hide Help</a>
      </div>
    </form>
  </div>
  <div class="span7">
    <div id="help_box" style="display: none;">
      <h2>Query Language Help</h2>
      <ul class="nav nav-tabs">
      <li><a class="help-link" data-name="find">Result Type</a>
      <li><a href="#" class="help-link" data-name="param-filter">Parameter Filter</a>
      <li><a href="#" class="help-link" data-name="sort">Sorting</a>
      <li><a href="#" class="help-link" data-name="other">Other</a>
      <li><a href="#" class="help-link" data-name="example-datas">Example Data Query</a>
      <li><a href="#" class="help-link" data-name="example-sets">Set Query</a>
      </ul>
      <div id="help_content">
      <p>Select a help category above.</p>
      </div>
    </div>
  </div>
</div>
<hr />
<div class="row-fluid">
  <div class="span6">
    <h2 id="bottom_headline">Query History</h2>
  </div>
  <div class="span6">
    <a href="#" id="query_history_btn" class="btn btn-large pull-right" style="display:none;"><i class="icon-list"></i>Change To History</a>
    <a href="#" id="query_results_btn" class="btn btn-large pull-right" style="display:none;"><i class="icon-list-alt"></i>Change To Results</a>
  </div>
</div>
<div class="row-fluid">
    <div id="bottom_content" class="span12">
      <div id="query_history_content">
        {{ queryhistory_table(query_history) }}
      </div>
      <div id="query_results_content" style="display:none;">
        <h3>No results yet.</h3>
      </div>
    </div>
</div>
{% endblock %}

{# vim: set filetype=htmljinja sw=2 ts=2 sts=2 expandtab: #}
