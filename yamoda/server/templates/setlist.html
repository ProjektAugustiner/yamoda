{% extends "layout.html" %}
{% set title = "Datasets" %}
{% macro setlist(sets, parent=None) %}
  <a class="btn" data-toggle="modal" href="#new_set">Create {% if parent %}sub{% endif %}set</a>
  <table id="settable" class="table table-condensed table-bordered table-striped">
    <thead>
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Subsets</th>
        <th>Datas</th>
        <th>Created</th>
      </tr>
    </thead>
    <tbody>
      {%- for set in sets %}
      <tr>
        <td>{{ loop.index }}</td>
        <td><a href="{{ url_for('set', id=set.id) }}">{{ set.name }}</a></td>
        <td>{{ set.children|length }}</td>
        <td>{{ set.datas|length }}</td>
        <td>{{ set.created|dtformat }}</td>
      </tr>
      {%- endfor %}
    </tbody>
  </table>
  <script>
    $(document).ready(function() {
      $('#settable').dataTable({bLengthChange: false, bPaginate: false});
    });
  </script>
  <div class="modal hide" id="new_set">
    <form class="modal-form" action="{{ url_for('setcreate') }}" method="post">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h3>Create new set</h3>
        {%- if parent %}
        <p>(as a child of {{ parent.name }})</p>
        {%- endif %}
      </div>
      <div class="modal-body">
        <label>Name</label>
        <input type="text" class="span3" placeholder="Set name…" name="name">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
          <i class="icon-ok-sign icon-white"></i> Create
        </button>
      </div>
    </form>
  </div>
{% endmacro %}
{% block body %}
  <h2>Datasets</h2>
  {{ setlist(sets) }}
{% endblock %}
