// Generated by CoffeeScript 1.3.3
(function() {
  var logg, query_links, self;

  query_links = $(".query_popover");

  query_links.each(function(index, link) {
    var text;
    text = link.text.replace(/,/g, "<br>");
    return $("#query_" + index).popover({
      content: text,
      title: "Click to insert #" + (index + 1),
      html: true,
      trigger: "hover"
    });
  });

  logg = yamoda.get_logger("yamoda.search");

  self = yamoda.search = {
    thisorthat: function() {
      return logg.info("this", this);
    },
    insert_query: function(row) {
      var newtext;
      newtext = $("#query_" + row).text().replace(/,/g, "\n");
      $("#query_input").val(newtext);
    },
    run_query: function(row) {
      logg.debug("called run_query");
      self.insert_query(row);
      $("#query_form").trigger("submit");
    },
    toggle_all_checkboxes: function(master_checkbox, $slave_checkboxes) {
      logg.debug("called toggle_all_checkboxes");
      if (master_checkbox.checked) {
        $slave_checkboxes.attr("checked", "checked");
      } else {
        $slave_checkboxes.removeAttr("checked");
      }
    },
    request_help_content: function(url) {
      return $.get(url, function(helptext) {
        logg.info("got helptext for", url);
        return $("#help-content").html(helptext);
      });
    },
    del_queries: function() {
      var ids;
      logg.info("called del_queries");
      ids = $.map($(".querycheck:checked"), function(el) {
        return el.id.substring(6);
      });
      logg.info("ids to delete: ", ids);
      if (!(ids != null)) {
        return;
      }
      $("actionbutton button").button("loading");
      logg.info("sending request to", that.del_queries_url);
      $.ajax({
        type: "POST",
        url: that.del_queries_url,
        data: {
          ids: ids
        },
        success: function(data, st, xhr) {
          window.location.reload();
          return $("checkbox_all").removeAttr("checked");
        },
        error: function(xhr, st, err) {
          logg.error("error in delete callback: ", err);
          $("actionbutton button").button("reset");
          return $("actionerror").text(err).show();
        }
      });
    }
  };

  yamoda.logg.info("yamoda.search loaded");

}).call(this);
