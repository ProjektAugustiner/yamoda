// Generated by CoffeeScript 1.3.3
(function() {
  var change_to_query_history, change_to_query_results, logg, query_history_html, query_results_html, query_results_shown, send_query_request;

  logg = yamoda.get_logger("yamoda.search");

  query_results_shown = false;

  query_history_html = "";

  query_results_html = "<h3>No results yet.</h3>";

  change_to_query_history = function() {
    logg.info("change_to_query_history");
    if (!query_results_shown) {
      return;
    }
    query_results_html = $("#bottom-content").html();
    $("#bottom-content").html(query_history_html);
    $("#query_results_btn").show();
    $("#query_history_btn").hide();
    $("#bottom-headline").text("Query History");
    return query_results_shown = false;
  };

  change_to_query_results = function() {
    logg.info("change_to_query_results");
    if (query_results_shown || query_results_html === "") {
      return;
    }
    query_history_html = $("#bottom-content").html();
    $("#bottom-content").html(query_results_html);
    $("#query_history_btn").show();
    $("#query_results_btn").hide();
    query_results_shown = true;
    return $("#bottom-headline").text("Query Results");
  };

  send_query_request = function() {
    var old_headline;
    logg.info("send query request");
    old_headline = $("#bottom-headline").text();
    $("#bottom-headline").text("Processing...");
    return $.ajax({
      type: 'POST',
      url: yamoda.search.search_url,
      data: {
        query: $("#query_input").val(),
        name: $("#query_name_input").val(),
        save_query: $("#save_query_checkbox").attr("checked")
      },
      success: function(data) {
        logg.info("received query request answer");
        query_results_html = data;
        $("#bottom-headline").text(old_headline);
        return change_to_query_results();
      }
    });
  };

  $(document).ready(function() {
    $("#query_history_btn").hide();
    $("#query_results_btn").hide();
    $('#query_form').submit(function() {
      var show_results;
      show_results = $("input[name='show_results']:checked").val();
      if (show_results === "newpage") {
        return true;
      } else {
        send_query_request();
        return false;
      }
    });
  });

  yamoda.search = {
    request_help_content: function(url) {
      return $.get(url, function(helptext) {
        logg.info("got helptext for", url);
        return $("#help-content").html(helptext);
      });
    },
    change_to_query_history: change_to_query_history,
    change_to_query_results: change_to_query_results
  };

  yamoda.logg.info("yamoda.search loaded");

}).call(this);
