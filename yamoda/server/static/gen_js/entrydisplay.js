// Generated by CoffeeScript 1.3.3

/*
# entrydisplay.coffee
# backing code for entry.html
#
# @author dpausp (Tobias Stenzel)
#
*/


/*-- private module vars --
*/


(function() {
  var MODULE_NAME, hide_values, init_1D, init_1D_ondemand, init_2D_ondemand, logg, set_plot_area_height, show_values, that;

  MODULE_NAME = "yamoda.entrydisplay";

  logg = void 0;

  that = void 0;

  /*-- module functions --
  */


  set_plot_area_height = function() {
    var height;
    height = $(window).height() * 0.45;
    yamoda.logg.info("new height of plot", height);
    $("#plot>.plot-area").height(height);
  };

  init_1D = function() {
    var plot_and_show;
    plot_and_show = function(entry) {
      yamoda.logg.info("plot_and_show");
      set_plot_area_height();
      yamoda.entry.show_values(entry, $("#values-display"));
      yamoda.entry.plot(entry, $("#plot"));
    };
    yamoda.entry.add(that.ENTRY_URL, that.ENTRY_ID, that.PARAMETER_NAME, that.ENTRY_VALUE);
    yamoda.entry.get(that.ENTRY_URL, plot_and_show);
    $(window).resize(function() {
      set_plot_area_height();
    });
  };

  hide_values = function() {
    yamoda.logg.debug("Hide values");
    $("#values-display").text("Values hidden");
    $("#values-toggle-btn").text("Show values");
  };

  show_values = function() {
    yamoda.logg.debug("Show values");
    $("#values-display").text("Wait...");
    yamoda.entry.get(that.ENTRY_URL, function(entry) {
      yamoda.entry.show_values(entry, $("#values-display"));
      return $("#values-toggle-btn").text("Hide values");
    });
  };

  init_1D_ondemand = function() {
    var hide_plot, initial_cb_plot, initial_cb_values, show_plot;
    show_plot = function() {
      yamoda.logg.debug("Show plot");
      $("#plot-toggle-btn").text("Wait...");
      set_plot_area_height();
      yamoda.entry.show_plot($("#plot"));
      $("#plot-toggle-btn").text("Hide plot");
    };
    hide_plot = function() {
      yamoda.logg.debug("Hide plot");
      yamoda.entry.hide_plot($("#plot"));
      $("#plot>.plot-area").height("auto");
      $("#plot-toggle-btn").text("Show plot");
    };
    initial_cb_plot = function() {
      $("#plot-toggle-btn").text("Wait...");
      yamoda.entry.get(that.ENTRY_URL, function(entry) {
        var values_btn;
        set_plot_area_height();
        yamoda.entry.plot(entry, $('#plot'));
        $("#plot-toggle-btn").off("click").toggle(hide_plot, show_plot).text("Hide plot").removeClass("initial");
        $(window).resize(function() {
          yamoda.logg.info("resize!");
          if (!$("#plot>.plot-area").hasClass("placeholder")) {
            set_plot_area_height();
          }
        });
        values_btn = $("#values-toggle-btn");
        if (values_btn.hasClass("initial")) {
          return values_btn.text("Show values").removeClass("initial");
        }
      });
    };
    initial_cb_values = function() {
      $("#values-toggle-btn").text("Wait...");
      yamoda.entry.get(that.ENTRY_URL, function(entry) {
        var plot_btn;
        yamoda.entry.show_values(entry, $("#values-display"));
        $("#values-toggle-btn").off("click").toggle(hide_values, show_values).text("Hide values").removeClass("initial");
        plot_btn = $("#plot-toggle-btn");
        if (plot_btn.hasClass("initial")) {
          return plot_btn.text("Show plot").removeClass("initial");
        }
      });
    };
    $("#plot-toggle-btn").click(initial_cb_plot).text("Request values and plot...");
    $("#values-toggle-btn").click(initial_cb_values);
  };

  init_2D_ondemand = function() {
    var hide_image, initial_cb_values, show_image;
    initial_cb_values = function() {
      $("#values-toggle-btn").text("Wait...");
      yamoda.entry.get(that.ENTRY_URL, function(entry) {
        yamoda.entry.show_values(entry, $("#values-display"));
        return $("#values-toggle-btn").off("click").toggle(hide_values, show_values).text("Hide values").removeClass("initial");
      });
    };
    show_image = function() {
      $("#plot>.plot-area").html('<img src="' + that.ENTRY_URL + '" alt="Plot image cannot be displayed">').removeClass("placeholder");
      $("#plot-toggle-btn").text("Hide Image");
    };
    hide_image = function() {
      $("#plot>.plot-area").text("Image hidden").addClass("placeholder");
      $("#plot-toggle-btn").text("Show Image");
    };
    $("#static-download-btn").text("Download image");
    $("#plot-toggle-btn").text("Show image").toggle(show_image, hide_image);
    $("#values-toggle-btn").click(initial_cb_values);
  };

  /*-- READY --
  */


  $(function() {
    that = yamoda.entrydisplay = yamoda.make_module(MODULE_NAME, {
      e1D: {
        init: init_1D
      },
      e1D_ondemand: {
        init: init_1D_ondemand
      },
      e2D_ondemand: {
        init: init_2D_ondemand
      }
    });
    logg = that.logg;
  });

}).call(this);
